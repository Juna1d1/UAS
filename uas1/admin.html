<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Inventaris</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f2f5; }
    input { margin: 5px; padding: 5px; width: 150px; }
    button { margin: 5px; padding: 6px 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; }
    th { background: #007bff; color: white; }
  </style>
</head>
<body>
  <h2>Admin - Kelola Inventaris</h2>

  <div>
    <input id="nama" placeholder="Nama Alat" />
    <input id="jumlah" type="number" placeholder="Jumlah" />
    <input id="lokasi" placeholder="Lokasi" />
    <input id="kondisi" placeholder="Kondisi" />
    <button onclick="tambahAlat()">Tambah</button>
  </div>

  <table>
    <thead>
      <tr><th>Nama Alat</th><th>Jumlah</th><th>Lokasi</th><th>Kondisi</th><th>Aksi</th></tr>
    </thead>
    <tbody id="inventarisBody"></tbody>
  </table>

  <h2>Persetujuan Peminjaman</h2>
  <table>
    <thead>
      <tr><th>Nama Alat</th><th>Jumlah</th><th>Peminjam</th><th>Status</th><th>Aksi</th></tr>
    </thead>
    <tbody id="peminjamanBody"></tbody>
  </table>

  <script>
    const supabase = supabase.createClient('https://pmgnuwototighfbmegdt.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBtZ251d290b3RpZ2hmYm1lZ2R0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1ODkwNTQsImV4cCI6MjA2MjE2NTA1NH0.QjQiA6V8HnV5LWviQGCbPuQ_PuxNAVqcbL6U_epUOEg');

    async function loadInventaris() {
      const { data } = await supabase.from('inventaris').select('*');
      const tbody = document.getElementById('inventarisBody');
      tbody.innerHTML = '';
      data.forEach(item => {
        tbody.innerHTML += `
          <tr>
            <td><input value="${item.nama_alat}" onchange="updateField('${item.id}', 'nama_alat', this.value)"/></td>
            <td><input type="number" value="${item.jumlah}" onchange="updateField('${item.id}', 'jumlah', this.value)"/></td>
            <td><input value="${item.lokasi}" onchange="updateField('${item.id}', 'lokasi', this.value)"/></td>
            <td><input value="${item.kondisi}" onchange="updateField('${item.id}', 'kondisi', this.value)"/></td>
            <td><button onclick="hapusAlat('${item.id}')">Hapus</button></td>
          </tr>`;
      });
    }

    async function tambahAlat() {
      const nama = document.getElementById('nama').value;
      const jumlah = parseInt(document.getElementById('jumlah').value);
      const lokasi = document.getElementById('lokasi').value;
      const kondisi = document.getElementById('kondisi').value;
      await supabase.from('inventaris').insert({ nama_alat: nama, jumlah, lokasi, kondisi });
      loadInventaris();
    }

    async function updateField(id, field, value) {
      await supabase.from('inventaris').update({ [field]: value }).eq('id', id);
    }

    async function hapusAlat(id) {
      await supabase.from('inventaris').delete().eq('id', id);
      loadInventaris();
    }

    async function loadPeminjaman() {
      const { data } = await supabase
        .from('peminjaman')
        .select('*')
        .eq('status', 'menunggu');

      const tbody = document.getElementById("peminjamanBody");
      tbody.innerHTML = data.map(item => `
        <tr>
          <td>${item.nama_alat}</td>
          <td>${item.jumlah}</td>
          <td>${item.peminjam}</td>
          <td>${item.status}</td>
          <td><button onclick="setujui('${item.id}')">Setujui</button></td>
        </tr>
      `).join('');
    }

    async function setujui(id) {
      await supabase.from("peminjaman").update({ status: "dipinjam" }).eq("id", id);
      loadPeminjaman();
    }

    loadInventaris();
    loadPeminjaman();
  </script>
</body>
</html>

